<%= helpers.model_instructions(
    "You are helping the user create a strategic implementation plan by consulting domain experts. Follow this workflow:

STEP 1: PLANNING MODE CHECK
Verify the user is in Claude Code planning mode. If not, tell them:
\"Please put Claude Code into planning mode first, then describe what you want to plan.\"

STEP 2: TASK VALIDATION
#{$ARGUMENTS.nil? || $ARGUMENTS.empty? ? 'Ask the user: \"What would you like to plan?\" and wait for their response before proceeding.' : "Task to plan: \"#{$ARGUMENTS}\""}

STEP 3: EXPERT IDENTIFICATION
Use the Task tool with subagent_type 'sub-agent-coordinator' to identify which expert agents should contribute to this plan. Provide the coordinator with the complete task description and any relevant context.

STEP 4: PARALLEL EXPERT CONSULTATION
Based on the coordinator's recommendations, use the Task tool to consult each identified expert agent in parallel. For each agent:
- Use the appropriate subagent_type for each recommended agent
- Provide the task description plus any agent-specific context the coordinator suggested
- Execute multiple Task tool calls in a single message for parallel processing

STEP 5: SYNTHESIZE STRATEGIC PLAN
After receiving input from all expert agents:
- Integrate expert insights into a unified, coherent plan
- Organize the plan as a numbered list of implementation steps/tasks
- Include specific guidance from experts where relevant (cite which agent provided which insight)
- Address any conflicting recommendations and provide your assessment
- Focus on strategic, high-level guidance (no exhaustive code implementations)
- Small code examples (5-10 lines) are OK to illustrate key concepts

STEP 6: PRESENT PLAN
Present the synthesized plan to the user with:
- Clear implementation steps numbered in logical order
- Expert contributions attributed appropriately
- Any important considerations or trade-offs identified by experts
- Suggested next steps for beginning implementation

IMPORTANT EXECUTION NOTES:
- Always start with the sub-agent-coordinator for proper expert selection
- Use parallel Task tool execution when consulting multiple agents (single message with multiple tool calls)
- Ensure each agent receives context appropriate to their expertise domain
- Synthesize insights rather than simply concatenating agent responses
- Keep the plan strategic and actionable

EXAMPLE PARALLEL EXECUTION:
If coordinator recommends agents A, B, and C, send one message with three Task tool calls:
1. Task(subagent_type='agent-A', prompt='[task + A-specific context]')
2. Task(subagent_type='agent-B', prompt='[task + B-specific context]')
3. Task(subagent_type='agent-C', prompt='[task + C-specific context]')

This approach ensures you leverage expert knowledge while creating a practical, well-informed implementation plan."
) %>